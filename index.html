<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Day 1 Orientation & Core Policies Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, doc, setDoc, getDoc, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBiluLa0pJYGFupERwbiYpBXtLMNcmzXNM",
            authDomain: "day1-training-tracker.firebaseapp.com",
            projectId: "day1-training-tracker",
            storageBucket: "day1-training-tracker.firebasestorage.app",
            messagingSenderId: "548137297985",
            appId: "1:548137297985:web:86bcc838443dd090c9bec0"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Make Firebase functions available globally
        window.firebaseDB = db;
        window.firestoreDoc = doc;
        window.firestoreSetDoc = setDoc;
        window.firestoreGetDoc = getDoc;
        window.firestoreServerTimestamp = serverTimestamp;
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
        }
        
        .progress-bar {
            transition: width 0.5s ease-in-out;
        }
        
        .celebration {
            animation: celebrationBounce 0.8s ease-in-out;
        }
        
        @keyframes celebrationBounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        
        .section-card {
            transition: all 0.3s ease;
        }
        
        .section-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .training-item {
            transition: all 0.2s ease;
        }
        
        .training-item:hover {
            transform: translateX(4px);
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .icon-circle {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            font-size: 18px;
        }
        
        .progress-circle {
            width: 20px;
            height: 20px;
            border: 2px solid #374151;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
            background-color: white;
            cursor: pointer;
            transition: all 0.2s ease;
            flex-shrink: 0;
            min-width: 20px;
            min-height: 20px;
        }
        
        .progress-circle.completed {
            background-color: #22c55e;
            border-color: #22c55e;
            color: white;
        }
        
        .progress-circle.completed::after {
            content: '‚úì';
            color: white;
            font-weight: bold;
        }
        
        .completed-item {
            background-color: rgba(34, 197, 94, 0.1);
            border-left: 4px solid #22c55e;
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .trophy-animation {
            animation: trophy 1s ease-in-out;
        }
        
        @keyframes trophy {
            0% { transform: scale(0) rotate(180deg); }
            50% { transform: scale(1.2) rotate(10deg); }
            100% { transform: scale(1) rotate(0deg); }
        }

        .submit-disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen py-8">
    <div id="progressTracker" class="max-w-6xl mx-auto p-6 bg-white rounded-2xl shadow-2xl border border-gray-200">
        <!-- Header Section -->
        <div class="mb-8">
            <div class="flex flex-col md:flex-row md:items-center justify-between mb-6">
                <div class="mb-4 md:mb-0">
                    <h1 class="text-4xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
                        Day 1: Orientation & Core Policies
                    </h1>
                    <p class="text-gray-600 text-lg mt-2">Complete all training modules to finish your first day</p>
                </div>
                <div class="text-center md:text-right">
                    <div class="relative">
                        <div class="w-24 h-24 mx-auto md:mx-0 rounded-full bg-gradient-to-r from-blue-500 to-green-500 flex items-center justify-center mb-2">
                            <div id="overallProgress" class="text-2xl font-bold text-white">0%</div>
                        </div>
                        <div class="text-sm text-gray-500 font-medium">Overall Complete</div>
                    </div>
                </div>
            </div>

            <!-- How to use instructions -->
            <div class="mb-6 p-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl border border-blue-200">
                <div class="flex items-start">
                    <div class="text-2xl mr-3">üí°</div>
                    <div>
                        <p class="text-sm text-blue-800">
                            <strong>How to use:</strong> Click on any training item to mark it as complete. 
                            Complete all modules and check the acknowledgment to enable the Submit button.
                            <span id="nameGreeting" class="block mt-1 font-semibold"></span>
                        </p>
                    </div>
                </div>
            </div>

            <!-- Employee Name Input -->
            <div class="mb-6">
                <label for="employeeName" class="block text-sm font-medium text-gray-700 mb-2">Employee Name</label>
                <input
                    type="text"
                    id="employeeName"
                    placeholder="Enter your name to personalize your experience"
                    class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                />
            </div>

            <!-- Overall Progress Bar -->
            <div class="mb-6">
                <div class="flex justify-between items-center mb-3">
                    <span class="text-sm font-semibold text-gray-700">Training Progress</span>
                    <span id="progressFraction" class="text-sm font-semibold text-gray-600">0 / 34 completed</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-6 shadow-inner">
                    <div 
                        id="overallProgressBar"
                        class="bg-gradient-to-r from-blue-500 via-purple-500 to-green-500 h-6 rounded-full progress-bar flex items-center justify-center relative overflow-hidden"
                        style="width: 0%"
                    >
                        <div class="absolute inset-0 bg-white opacity-20 animate-pulse"></div>
                        <span id="progressText" class="text-white text-sm font-bold relative z-10" style="display: none;">0%</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Celebration Banner -->
        <div id="celebration" class="mb-8 p-6 bg-gradient-to-r from-yellow-400 via-orange-400 to-red-400 rounded-2xl text-center celebration shadow-lg" style="display: none;">
            <div class="flex items-center justify-center mb-3">
                <span class="text-4xl trophy-animation">üèÜ</span>
                <span class="text-white font-bold text-2xl mx-3">All Modules Complete!</span>
                <span class="text-4xl trophy-animation">üéâ</span>
            </div>
            <p class="text-white text-lg font-medium" id="celebrationText">
                You've completed all training modules! Don't forget to check the acknowledgment and submit.
            </p>
            <div class="mt-4">
                <span class="inline-block bg-white bg-opacity-20 text-white px-4 py-2 rounded-full text-sm font-semibold">
                    Ready for Acknowledgment ‚ú®
                </span>
            </div>
        </div>

        <!-- Section Progress Cards -->
        <div class="space-y-8 mb-8">
            <!-- Module 1: Payroll & Paperwork -->
            <div class="section-card bg-gradient-to-br from-blue-50 to-blue-100 rounded-2xl p-6 border-2 border-blue-200 shadow-lg">
                <div class="flex items-center mb-6">
                    <div class="flex-1">
                        <h3 class="text-2xl font-bold text-gray-800">Module 1: Payroll & Paperwork</h3>
                        <p class="text-sm text-gray-600">Before you begin, check your email for a message from ADP with instructions to self-onboard. This email is your access point to set up payroll & complete required forms.</p>
                    </div>
                    <div class="text-right">
                        <div id="module1Percent" class="text-2xl font-bold text-blue-600">0%</div>
                        <div class="text-xs text-gray-500">Complete</div>
                    </div>
                </div>

                <div class="mb-4">
                    <div class="w-full bg-blue-200 rounded-full h-3">
                        <div 
                            id="module1Progress"
                            class="bg-gradient-to-r from-blue-500 to-blue-600 h-3 rounded-full progress-bar"
                            style="width: 0%"
                        ></div>
                    </div>
                </div>

                <div class="space-y-3 mb-4" id="module1Items">
                    <!-- Items will be generated by JavaScript -->
                </div>

                <div class="pt-4 border-t border-blue-200">
                    <div class="flex justify-between items-center">
                        <span id="module1Summary" class="text-sm text-gray-600">0 of 9 completed</span>
                        <span id="module1Complete" class="text-sm text-green-600 font-semibold bg-green-100 px-2 py-1 rounded-full" style="display: none;">
                            ‚úì Module Complete
                        </span>
                    </div>
                </div>
            </div>

            <!-- Module 2: Time To Pet Setup -->
            <div class="section-card bg-gradient-to-br from-green-50 to-green-100 rounded-2xl p-6 border-2 border-green-200 shadow-lg">
                <div class="flex items-center mb-6">
                    <div class="flex-1">
                        <h3 class="text-2xl font-bold text-gray-800">Module 2: Time To Pet Setup</h3>
                        <p class="text-sm text-gray-600">Account setup and app training</p>
                    </div>
                    <div class="text-right">
                        <div id="module2Percent" class="text-2xl font-bold text-green-600">0%</div>
                        <div class="text-xs text-gray-500">Complete</div>
                    </div>
                </div>

                <div class="mb-4">
                    <div class="w-full bg-green-200 rounded-full h-3">
                        <div 
                            id="module2Progress"
                            class="bg-gradient-to-r from-green-500 to-green-600 h-3 rounded-full progress-bar"
                            style="width: 0%"
                        ></div>
                    </div>
                </div>

                <div class="space-y-3 mb-4" id="module2Items">
                    <!-- Items will be generated by JavaScript -->
                </div>

                <div class="pt-4 border-t border-green-200">
                    <div class="flex justify-between items-center">
                        <span id="module2Summary" class="text-sm text-gray-600">0 of 11 completed</span>
                        <span id="module2Complete" class="text-sm text-green-600 font-semibold bg-green-100 px-2 py-1 rounded-full" style="display: none;">
                            ‚úì Module Complete
                        </span>
                    </div>
                </div>
            </div>

            <!-- Module 3: Company Story & Culture -->
            <div class="section-card bg-gradient-to-br from-orange-50 to-orange-100 rounded-2xl p-6 border-2 border-orange-200 shadow-lg">
                <div class="flex items-center mb-6">
                    <div class="flex-1">
                        <h3 class="text-2xl font-bold text-gray-800">Module 3: Our Story, Mission, Vision & Culture</h3>
                        <p class="text-sm text-gray-600">Get to know our company and what we stand for by reviewing the following</p>
                    </div>
                    <div class="text-right">
                        <div id="module3Percent" class="text-2xl font-bold text-orange-600">0%</div>
                        <div class="text-xs text-gray-500">Complete</div>
                    </div>
                </div>

                <div class="mb-4">
                    <div class="w-full bg-orange-200 rounded-full h-3">
                        <div 
                            id="module3Progress"
                            class="bg-gradient-to-r from-orange-500 to-orange-600 h-3 rounded-full progress-bar"
                            style="width: 0%"
                        ></div>
                    </div>
                </div>

                <div class="space-y-3 mb-4" id="module3Items">
                    <!-- Items will be generated by JavaScript -->
                </div>

                <div class="pt-4 border-t border-orange-200">
                    <div class="flex justify-between items-center">
                        <span id="module3Summary" class="text-sm text-gray-600">0 of 4 completed</span>
                        <span id="module3Complete" class="text-sm text-green-600 font-semibold bg-green-100 px-2 py-1 rounded-full" style="display: none;">
                            ‚úì Module Complete
                        </span>
                    </div>
                </div>
            </div>

            <!-- Module 4: Core Company Policies -->
            <div class="section-card bg-gradient-to-br from-purple-50 to-purple-100 rounded-2xl p-6 border-2 border-purple-200 shadow-lg">
                <div class="flex items-center mb-6">
                    <div class="flex-1">
                        <h3 class="text-2xl font-bold text-gray-800">Module 4: Core Company Policies</h3>
                        <p class="text-sm text-gray-600">Review the following essential company policies</p>
                    </div>
                    <div class="text-right">
                        <div id="module4Percent" class="text-2xl font-bold text-purple-600">0%</div>
                        <div class="text-xs text-gray-500">Complete</div>
                    </div>
                </div>

                <div class="mb-4">
                    <div class="w-full bg-purple-200 rounded-full h-3">
                        <div 
                            id="module4Progress"
                            class="bg-gradient-to-r from-purple-500 to-purple-600 h-3 rounded-full progress-bar"
                            style="width: 0%"
                        ></div>
                    </div>
                </div>

                <div class="space-y-3 mb-4" id="module4Items">
                    <!-- Items will be generated by JavaScript -->
                </div>

                <div class="pt-4 border-t border-purple-200">
                    <div class="flex justify-between items-center">
                        <span id="module4Summary" class="text-sm text-gray-600">0 of 10 completed</span>
                        <span id="module4Complete" class="text-sm text-green-600 font-semibold bg-green-100 px-2 py-1 rounded-full" style="display: none;">
                            ‚úì Module Complete
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Progress Summary Dashboard -->
        <div class="mb-8 p-6 bg-gradient-to-r from-gray-50 to-gray-100 rounded-2xl border border-gray-200">
            <h4 class="text-xl font-bold text-gray-800 mb-6 text-center">Module Summary Dashboard</h4>
            <div class="grid grid-cols-2 lg:grid-cols-4 gap-6">
                <div class="text-center p-4 bg-white rounded-xl shadow-md border border-blue-100">
                    <div id="module1Sum" class="text-3xl font-bold text-blue-600 mb-1">0%</div>
                    <div class="text-sm text-gray-600 font-medium">Module 1: Payroll & Paperwork</div>
                </div>
                <div class="text-center p-4 bg-white rounded-xl shadow-md border border-green-100">
                    <div id="module2Sum" class="text-3xl font-bold text-green-600 mb-1">0%</div>
                    <div class="text-sm text-gray-600 font-medium">Module 2: Time to Pet Setup</div>
                </div>
                <div class="text-center p-4 bg-white rounded-xl shadow-md border border-orange-100">
                    <div id="module3Sum" class="text-3xl font-bold text-orange-600 mb-1">0%</div>
                    <div class="text-sm text-gray-600 font-medium">Module 3: Company Culture</div>
                </div>
                <div class="text-center p-4 bg-white rounded-xl shadow-md border border-purple-100">
                    <div id="module4Sum" class="text-3xl font-bold text-purple-600 mb-1">0%</div>
                    <div class="text-sm text-gray-600 font-medium">Module 4: Company Policies</div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="mb-6 flex justify-center">
            <button 
                id="saveButton"
                class="bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white font-bold py-4 px-6 rounded-xl transition-all transform hover:scale-105 shadow-lg"
            >
                üíæ Save Progress
            </button>
        </div>

        <!-- Acknowledgment Section -->
        <div class="mb-8 p-6 bg-gradient-to-r from-red-50 to-red-100 rounded-2xl border-2 border-red-200 shadow-lg">
            <h4 class="text-xl font-bold text-gray-800 mb-4 text-center">Final Acknowledgment</h4>
            <div class="bg-white p-6 rounded-xl border border-red-200">
                <div class="flex items-start">
                    <input 
                        type="checkbox" 
                        id="acknowledgmentCheckbox" 
                        class="mt-1 mr-4 h-5 w-5 text-red-600 focus:ring-red-500 border-gray-300 rounded"
                    />
                    <label for="acknowledgmentCheckbox" class="text-gray-800 font-medium cursor-pointer">
                        I acknowledge that I have read, understood and completed ALL tasks within Day 1: Orientation and Core Policies
                    </label>
                </div>
            </div>
        </div>

        <!-- Submit Button -->
        <div class="mb-6 flex justify-center">
            <button 
                id="submitButton"
                class="submit-disabled text-black font-bold py-4 px-8 rounded-xl transition-all transform shadow-lg"
                style="background-color: #11d9f3;"
                disabled
            >
                üì® Submit Acknowledgment
            </button>
        </div>
    </div>

    <script>
        // Initialize EmailJS
        emailjs.init("u6gnveZG6T3TdyZF2");

        // Training data structure
        const trainingData = {
            module1: [
                '<strong style="font-size: 18px;">Sign up for MyADP using the link in your onboarding email</strong>',
                '     <span style="font-size: 18px;">Complete Personal Info, W-4, and Direct Deposit directly in MyADP</span>',
                '     <span style="font-size: 18px;">Review and sign off on the Employee Handbook within ADP</span>',
                '     <span style="font-size: 18px;">Opt in to Paperless W-2 Delivery to ensure secure, fast access at tax time</span>',
                '     <span style="font-size: 18px;">Download the ADP Run App (iOS or Android) for mobile access to payroll and pay stubs</span>',
                '<strong style="font-size: 18px;">Form I-9 Employment Eligibility</strong>',
                '     <span style="font-size: 18px;">Download & complete Sections 1 & 2</span>',
                '     <span style="font-size: 18px;">Provide required identification documents</span>',
                '     <span style="font-size: 18px;">A wet signature is required. Return the completed form as instructed</span>'
            ],
            module2: [
                '<strong style="font-size: 18px;">Create your Time To Pet (TTP) account via web, not app, and fill out the following fields:</strong>',
                '     <span style="font-size: 18px;">Personal info (phone, emergency contact, address, birth date, hire date)</span>',
                '     <span style="font-size: 18px;">Upload profile photo & short bio</span>',
                '     <span style="font-size: 18px;">Set schedule & request any pre-planned time off</span>',
                '<strong style="font-size: 18px;">Learn how to:</strong>',
                '     <span style="font-size: 18px;">Clock in/out</span>',
                '     <span style="font-size: 18px;">Log mileage</span>',
                '     <span style="font-size: 18px;">View schedule</span>',
                '     <span style="font-size: 18px;">Start/stop event timer</span>',
                '<strong style="font-size: 18px;">Download Time To Pet app</strong>',
                '<strong style="font-size: 18px;">Demo Video: Short screen-recording (2‚Äì3 mins)</strong>'
            ],
            module3: [
                '<span style="font-size: 18px;">Our Story & Meet the Team</span>',
                '<span style="font-size: 18px;">Mission, Vision & Values</span>',
                '<span style="font-size: 18px;">Company Culture</span>',
                '<span style="font-size: 18px;">Take the Company Culture Quiz</span>'
            ],
            module4: [
                '<strong style="font-size: 18px;"><a href="https://docs.google.com/document/d/1D3xy7zpnrI7Zztef00P9bF34UJsMZboa6xnJ2kmqUu0/edit?tab=t.0#heading=h.bv2bjhzf6h6q" target="_blank" class="text-purple-600 hover:text-purple-800 underline">Employee Handbook Overview</a></strong>',
                '<strong style="font-size: 18px;"><a href="https://docs.google.com/document/d/1NAM9jimnUKm8xScSG7cSV9-aHKlcvbu2h7cCBRfcFek/edit?tab=t.0#heading=h.7bethilgrvt4" target="_blank" class="text-purple-600 hover:text-purple-800 underline">Confidentiality & Privacy</a></strong>',
                '<strong style="font-size: 18px;"><a href="https://docs.google.com/document/d/11xkQXMKux7p3CVwGQ43lm2kLDVL7R8zoZpkWxdgW5yU/edit?tab=t.0#heading=h.7bethilgrvt4" target="_blank" class="text-purple-600 hover:text-purple-800 underline">Attendance & Punctuality</a></strong>',
                '<strong style="font-size: 18px;"><a href="https://docs.google.com/document/d/1z4hPSJO1Cczt1YbnZknh5YZ-NO3EEXPMnwBnDckK_p4/edit?tab=t.0#heading=h.7bethilgrvt4" target="_blank" class="text-purple-600 hover:text-purple-800 underline">Time Off & Schedule Change Requests</a></strong>',
                '<strong style="font-size: 18px;"><a href="https://docs.google.com/document/d/1F-fkPdt8Kk6WMpQmiI4zWVYUE1Kj1g30mxUYkhcTCSg/edit?tab=t.0#heading=h.7bethilgrvt4" target="_blank" class="text-purple-600 hover:text-purple-800 underline">Dress Code & Uniform</a></strong>',
                '<strong style="font-size: 18px;"><a href="https://docs.google.com/document/d/1RoQEPTeDtLfy2CyZTI_h_RxLDT_0OiRxmuZA0fiEK1o/edit?tab=t.0#heading=h.7bethilgrvt4" target="_blank" class="text-purple-600 hover:text-purple-800 underline">Equipment & Supplies</a></strong>',
                '<strong style="font-size: 18px;"><a href="https://docs.google.com/document/d/1L6Ze_dn3TBJyxSZ20akx7EkMc6XEBkCTvJPzCKKQZq4/edit?tab=t.0#heading=h.7bethilgrvt4" target="_blank" class="text-purple-600 hover:text-purple-800 underline">Safety & Security Basics</a></strong>',
                '<strong style="font-size: 18px;"><a href="https://docs.google.com/document/d/1ncKpmKayhag7vXOU7-qDB5-ZB1tW6MqUW55TC5ru7Vo/edit?tab=t.0#heading=h.7bethilgrvt4" target="_blank" class="text-purple-600 hover:text-purple-800 underline">Professional Boundaries</a></strong>',
                '<strong style="font-size: 18px;"><a href="https://docs.google.com/document/d/1mWsiI35PoRSHGKA37Jh8nspWippx6a182AyzMXV40h4/edit?tab=t.0#heading=h.7bethilgrvt4" target="_blank" class="text-purple-600 hover:text-purple-800 underline">Substance-Free Workplace</a></strong>',
                '<strong style="font-size: 18px;">Quiz</strong>'
            ]
        };

        let completedItems = {};
        let totalItems = 0;
        let currentEmployeeName = '';
        let isLoading = false;

        // Calculate total items
        Object.values(trainingData).forEach(items => {
            totalItems += items.length;
        });

        // Firebase functions - Updated for multi-day structure
        async function saveProgressToFirebase(employeeName, progressData) {
            if (!employeeName || !window.firebaseDB) return;
            
            try {
                const docRef = window.firestoreDoc(window.firebaseDB, 'employees', employeeName.toLowerCase().trim());
                const trainingDayData = {
                    completedItems: progressData,
                    lastUpdated: window.firestoreServerTimestamp(),
                    totalItems: totalItems
                };
                
                // Update only the specific training day
                await window.firestoreSetDoc(docRef, {
                    employeeName: employeeName,
                    training_days: {
                        day1_orientation_core_policies: trainingDayData
                    }
                }, { merge: true }); // merge: true preserves other training days
                
                console.log('Day 1 progress saved to Firebase');
            } catch (error) {
                console.error('Error saving to Firebase:', error);
            }
        }

        async function loadProgressFromFirebase(employeeName) {
            if (!employeeName || !window.firebaseDB) return null;
            
            try {
                const docRef = window.firestoreDoc(window.firebaseDB, 'employees', employeeName.toLowerCase().trim());
                const docSnap = await window.firestoreGetDoc(docRef);
                
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    // Return only Day 1 progress
                    return data.training_days?.day1_orientation_core_policies || null;
                } else {
                    console.log('No saved progress found');
                    return null;
                }
            } catch (error) {
                console.error('Error loading from Firebase:', error);
                return null;
            }
        }

        // Save acknowledgment completion
        async function saveAcknowledmentToFirebase(employeeName) {
            if (!employeeName || !window.firebaseDB) return;
            
            try {
                const docRef = window.firestoreDoc(window.firebaseDB, 'employees', employeeName.toLowerCase().trim());
                await window.firestoreSetDoc(docRef, {
                    training_days: {
                        day1_orientation_core_policies: {
                            acknowledgmentCompleted: true,
                            submissionDate: window.firestoreServerTimestamp()
                        }
                    }
                }, { merge: true });
                
                console.log('Day 1 acknowledgment saved to Firebase');
            } catch (error) {
                console.error('Error saving acknowledgment to Firebase:', error);
            }
        }

        // Auto-save function
        async function autoSave() {
            if (currentEmployeeName && !isLoading) {
                await saveProgressToFirebase(currentEmployeeName, completedItems);
            }
        }

        // Initialize the widget
        function initializeWidget() {
            Object.keys(trainingData).forEach(section => {
                const container = document.getElementById(`${section}Items`);
                if (!container) {
                    console.error(`Container not found for ${section}`);
                    return;
                }
                
                trainingData[section].forEach((item, index) => {
                    const itemDiv = document.createElement('div');
                    
                    // Check if this is an indented sub-item
                    const isSubItem = item.trim().length !== item.length; // Check if item starts with spaces
                    const marginClass = isSubItem ? 'ml-6' : '';
                    
                    itemDiv.className = `training-item ${marginClass} flex items-center p-3 rounded-xl cursor-pointer hover:bg-white transition-all border border-transparent hover:border-gray-200 hover:shadow-md`;
                    itemDiv.onclick = () => toggleItem(section, index);
                    
                    // Create checkbox element
                    const checkbox = document.createElement('div');
                    checkbox.className = 'progress-circle mr-4 flex-shrink-0';
                    checkbox.id = `${section}-${index}-icon`;
                    
                    // Create text element
                    const textSpan = document.createElement('span');
                    textSpan.className = 'text-sm font-medium text-gray-800 flex-1';
                    textSpan.id = `${section}-${index}-text`;
                    textSpan.innerHTML = item;
                    
                    itemDiv.appendChild(checkbox);
                    itemDiv.appendChild(textSpan);
                    container.appendChild(itemDiv);
                });
            });
            updateAllProgress();
            updateSubmitButton();
        }

        // Toggle item completion
        function toggleItem(section, index) {
            const key = `${section}-${index}`;
            completedItems[key] = !completedItems[key];
            
            const icon = document.getElementById(`${key}-icon`);
            const text = document.getElementById(`${key}-text`);
            const container = icon.parentElement;
            
            if (completedItems[key]) {
                icon.className = 'progress-circle completed mr-4 flex-shrink-0';
                text.className = 'text-sm font-medium text-gray-600 line-through flex-1';
                container.className = container.className.replace('training-item', 'training-item completed-item');
            } else {
                icon.className = 'progress-circle mr-4 flex-shrink-0';
                text.className = 'text-sm font-medium text-gray-800 flex-1';
                const isSubItem = trainingData[section][index].trim().length !== trainingData[section][index].length;
                const marginClass = isSubItem ? 'ml-6' : '';
                container.className = `training-item ${marginClass} flex items-center p-3 rounded-xl cursor-pointer hover:bg-white transition-all border border-transparent hover:border-gray-200 hover:shadow-md`;
            }
            
            updateAllProgress();
            checkCelebration();
            updateSubmitButton();
            
            // Auto-save after each change
            autoSave();
        }

        // Load saved progress and update UI
        async function loadSavedProgress(progressData) {
            if (!progressData || !progressData.completedItems) return;
            
            isLoading = true;
            completedItems = progressData.completedItems;
            
            Object.keys(completedItems).forEach(key => {
                if (completedItems[key]) {
                    const [section, index] = key.split('-');
                    const icon = document.getElementById(`${key}-icon`);
                    const text = document.getElementById(`${key}-text`);
                    const container = icon?.parentElement;
                    
                    if (icon && text && container) {
                        icon.className = 'progress-circle completed mr-4 flex-shrink-0';
                        text.className = 'text-sm font-medium text-gray-600 line-through flex-1';
                        container.className = container.className.replace('training-item', 'training-item completed-item');
                    }
                }
            });
            
            updateAllProgress();
            updateSubmitButton();
            isLoading = false;
        }

        // Update all progress indicators
        function updateAllProgress() {
            Object.keys(trainingData).forEach(section => {
                updateSectionProgress(section);
            });
            updateOverallProgress();
        }

        // Update section progress
        function updateSectionProgress(section) {
            const items = trainingData[section];
            const completed = items.filter((_, index) => completedItems[`${section}-${index}`]).length;
            const percentage = Math.round((completed / items.length) * 100);
            
            document.getElementById(`${section}Progress`).style.width = `${percentage}%`;
            document.getElementById(`${section}Percent`).textContent = `${percentage}%`;
            document.getElementById(`${section}Summary`).textContent = `${completed} of ${items.length} completed`;
            document.getElementById(`${section}Sum`).textContent = `${percentage}%`;
            
            const completeIndicator = document.getElementById(`${section}Complete`);
            completeIndicator.style.display = percentage === 100 ? 'inline-block' : 'none';
        }

        // Update overall progress
        function updateOverallProgress() {
            const completed = Object.keys(completedItems).filter(key => completedItems[key]).length;
            const percentage = Math.round((completed / totalItems) * 100);
            
            document.getElementById('overallProgress').textContent = `${percentage}%`;
            document.getElementById('overallProgressBar').style.width = `${percentage}%`;
            document.getElementById('progressFraction').textContent = `${completed} / ${totalItems} completed`;
            
            const progressText = document.getElementById('progressText');
            if (percentage > 15) {
                progressText.style.display = 'block';
                progressText.textContent = `${percentage}%`;
            } else {
                progressText.style.display = 'none';
            }
        }

        // Check for celebration
        function checkCelebration() {
            const completed = Object.keys(completedItems).filter(key => completedItems[key]).length;
            if (completed === totalItems) {
                const celebration = document.getElementById('celebration');
                celebration.style.display = 'block';
                setTimeout(() => {
                    celebration.style.display = 'none';
                }, 8000);
            }
        }

        // Update submit button state
        function updateSubmitButton() {
            const completed = Object.keys(completedItems).filter(key => completedItems[key]).length;
            const acknowledgmentChecked = document.getElementById('acknowledgmentCheckbox').checked;
            const submitButton = document.getElementById('submitButton');
            
            const allComplete = completed === totalItems && acknowledgmentChecked;
            
            if (allComplete) {
                submitButton.disabled = false;
                submitButton.className = 'text-black font-bold py-4 px-8 rounded-xl transition-all transform hover:scale-105 shadow-lg';
                submitButton.style.backgroundColor = '#11d9f3';
            } else {
                submitButton.disabled = true;
                submitButton.className = 'submit-disabled text-black font-bold py-4 px-8 rounded-xl transition-all transform shadow-lg';
                submitButton.style.backgroundColor = '#11d9f3';
            }
        }

        // Generate modules completed summary
        function getModulesCompletedSummary() {
            let summary = '';
            Object.keys(trainingData).forEach(section => {
                const items = trainingData[section];
                const completed = items.filter((_, index) => completedItems[`${section}-${index}`]).length;
                const percentage = Math.round((completed / items.length) * 100);
                const moduleName = {
                    'module1': 'Module 1: Payroll & Paperwork',
                    'module2': 'Module 2: Time To Pet Setup',
                    'module3': 'Module 3: Our Story, Mission & Culture',
                    'module4': 'Module 4: Core Company Policies'
                }[section];
                
                summary += `${moduleName} - ${percentage}% Complete (${completed}/${items.length})\n`;
            });
            return summary;
        }

        // Submit acknowledgment
        function submitAcknowledgment() {
            const employeeName = document.getElementById('employeeName').value.trim();
            const completed = Object.keys(completedItems).filter(key => completedItems[key]).length;
            const acknowledgmentChecked = document.getElementById('acknowledgmentCheckbox').checked;

            // Validation checks
            if (!employeeName) {
                alert('Please enter your name at the beginning of the checklist to complete, enter your name and click Submit again');
                return;
            }

            if (completed !== totalItems) {
                alert('It looks like you have not completed all the tasks, please go back and complete tasks and ensure you have checked off the tasks in the checklist');
                return;
            }

            if (!acknowledgmentChecked) {
                alert('Please check the acknowledgment checkbox to confirm you have completed all tasks');
                return;
            }

            // Prepare email data
            const templateParams = {
                employee_name: employeeName,
                acknowledge_date: new Date().toLocaleDateString(),
                acknowledge_checkbox: 'Confirmed',
                modules_completed: getModulesCompletedSummary()
            };

            // Send email via EmailJS
            emailjs.send('service_od1iofm', 'template_z5d6izs', templateParams)
                .then(function(response) {
                    console.log('SUCCESS!', response.status, response.text);
                    
                    // Save acknowledgment completion to Firebase
                    saveAcknowledmentToFirebase(employeeName);
                    
                    alert('Congratulations on completing your first days training modules for "New Hire: Orientation and Core Polices", when ready you can begin Day 2 Training');
                }, function(error) {
                    console.log('FAILED...', error);
                    alert('Acknowledgement email failed to send, please call Monica and inform her of the error');
                });
        }

        // Event listeners
        document.getElementById('employeeName').addEventListener('input', async function() {
            const name = this.value.trim();
            const greeting = document.getElementById('nameGreeting');
            
            if (name) {
                greeting.textContent = `Great job, ${name}! Keep up the excellent progress!`;
                
                // Check if this employee has saved progress
                if (name !== currentEmployeeName) {
                    currentEmployeeName = name;
                    const savedProgress = await loadProgressFromFirebase(name);
                    
                    if (savedProgress) {
                        const confirmLoad = confirm(`Welcome back, ${name}! We found your previous progress. Would you like to continue where you left off?`);
                        if (confirmLoad) {
                            await loadSavedProgress(savedProgress);
                        }
                    }
                }
            } else {
                greeting.textContent = '';
                currentEmployeeName = '';
            }
            
            updateSubmitButton();
        });

        document.getElementById('acknowledgmentCheckbox').addEventListener('change', function() {
            updateSubmitButton();
        });

        document.getElementById('submitButton').addEventListener('click', function() {
            if (!this.disabled) {
                submitAcknowledgment();
            }
        });

        document.getElementById('saveButton').addEventListener('click', async function() {
            const name = document.getElementById('employeeName').value.trim();
            if (!name) {
                alert('Please enter your name before saving progress.');
                return;
            }
            
            const completed = Object.keys(completedItems).filter(key => completedItems[key]).length;
            
            try {
                await saveProgressToFirebase(name, completedItems);
                const message = `Progress saved for ${name}! ${completed} of ${totalItems} items completed.`;
                alert(message + '\n\nYour progress has been saved and will be available when you return.');
            } catch (error) {
                alert('Error saving progress. Please try again or contact support if the problem persists.');
                console.error('Save error:', error);
            }
        });
        // test comment
        // Initialize the widget when page loads
        initializeWidget();
    </script>
</body>
</html>